{% from "partials/regenerate_form.html" import regenerate_form %}

<div id="lemma-content" class="fade-in">
  <div class="card card-section">
    <div class="focus-title">
      {{ content.lemma if content else lemma_display }}
    </div>
    <audio
      class="lemma-audio"
      controls
      preload="none"
      src="{{ url_for('lemma_audio', lang=language, lemma=lemma_text) }}"></audio>
    {% if content %}
      <p class="lemma-translation">{{ content.translation }}</p>
    {% endif %}
  </div>

  {% if content and content.related_words %}
    <div class="content-section">
      <h2 class="section-title section-title--spaced">Related words</h2>
      <div class="card list-card">
        {% for item in content.related_words %}
          <div class="list-row list-row--stacked">
            <div class="list-row__heading">
              <a class="link list-row__link" href="{{ item.normalized_lemma | lemma_url(language) }}">
                {{ item.word }}
              </a>
              <span class="list-row__meta">({{ item.translation }})</span>
            </div>
            {% if item.note %}
              <p class="list-row__note">{{ item.note }}</p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  {% if sentences %}
    <div class="content-section">
      <h2 class="section-title section-title--spaced">Sentences containing this lemma</h2>
      <div class="card list-card">
        {% for sentence in sentences %}
          <div class="list-row">
            <a class="link list-row__link" href="{{ url_for('sentence_detail', lang=language, hash_slug=sentence.hash) }}">
              {{ sentence.text }}
            </a>
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}

  <div class="action-bar action-bar--spaced">
    {% if error %}
      <div class="alert alert-danger action-alert">
        {{ error }}
      </div>
    {% endif %}

    <div class="action-row">
      {% set target_id = "lemma-favorite-" ~ lemma_id %}
      {% set action = url_for('lemma_favorite', lang=language, lemma=lemma_text) %}
      {% include "partials/favorite_star.html" %}

      {{ regenerate_form(
        url_for('lemma_regenerate', lang=language, lemma=lemma_text),
        "#lemma-content",
        "lemma-model",
        model_choices,
        selected_model,
        error
      ) }}

      <span class="action-hint">
        Generated with {{ content.model_used if content else 'unknown' }}
      </span>
    </div>
  </div>
</div>
