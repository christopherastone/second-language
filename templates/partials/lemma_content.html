<div id="lemma-content" class="space-y-10 fade-in">
  <div class="section-block">
    <div class="focus-title">
      {{ content.lemma if content else lemma_display }}
    </div>
    {% if content %}
      <div class="text-[color:var(--muted)] mt-2">{{ content.translation }}</div>
    {% endif %}
  </div>

  {% if content and content.related_words %}
    <div class="section-block">
      <h2 class="section-title mb-3">Related words</h2>
      <ul class="space-y-2">
        {% for item in content.related_words %}
          <li>
            <a class="underline decoration-[color:var(--border)] hover:decoration-[color:var(--accent)]" href="{{ item.normalized_lemma | lemma_url(language) }}">
              {{ item.word }}
            </a>
            <span class="text-[color:var(--muted)]">({{ item.translation }})</span>
            <div class="text-xs text-[color:var(--muted)]">{{ item.note }}</div>
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  {% if sentences %}
    <div class="section-block">
      <h2 class="section-title mb-3">Sentences containing this lemma</h2>
      <ul class="space-y-2">
        {% for sentence in sentences %}
          <li>
            <a class="underline decoration-[color:var(--border)] hover:decoration-[color:var(--accent)]" href="{{ url_for('sentence_detail', lang=language, hash_slug=sentence.hash) }}">
              {{ sentence.text }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}

  <div class="pt-6 border-t border-[color:var(--border)] space-y-4">
    {% if error %}
      <div class="text-sm text-red-600">{{ error }}</div>
    {% endif %}

    <div class="flex flex-wrap items-center gap-4">
      {% set target_id = "lemma-favorite-" ~ lemma_id %}
      {% set action = url_for('lemma_favorite', lang=language, lemma=lemma_text) %}
      {% include "partials/favorite_star.html" %}

      <form
        method="post"
        action="{{ url_for('lemma_regenerate', lang=language, lemma=lemma_text) }}"
        hx-post="{{ url_for('lemma_regenerate', lang=language, lemma=lemma_text) }}"
        hx-target="#lemma-content"
        hx-swap="outerHTML"
        hx-push-url="false"
        class="flex flex-wrap items-center gap-2"
        hx-disabled-elt="button"
        hx-on:htmx:beforeRequest="const btn=this.querySelector('button'); btn.dataset.label=btn.innerText; btn.innerText='Regenerating...'; btn.setAttribute('aria-busy','true');"
        hx-on:htmx:afterRequest="const btn=this.querySelector('button'); btn.innerText=btn.dataset.label || 'Regenerate'; btn.removeAttribute('aria-busy');"
      >
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <label class="text-sm text-[color:var(--muted)]" for="lemma-model">Model</label>
        <select
          id="lemma-model"
          name="model"
          class="border border-[color:var(--border)] rounded-full px-3 py-1 text-sm bg-white"
        >
          {% for model in model_choices %}
            <option value="{{ model }}" {% if model == selected_model %}selected{% endif %}>{{ model }}</option>
          {% endfor %}
        </select>
        <button type="submit" class="btn btn-primary">
          {{ "Try again" if error else "Regenerate" }}
        </button>
      </form>

      <div class="text-xs text-[color:var(--muted)]">
        Generated with: {{ content.model_used if content else 'unknown' }}
      </div>
    </div>
  </div>
</div>
